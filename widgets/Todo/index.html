<div class='ui medium form'>
	<div class='fields'>
		<div class='field' class='ui two stackable'>
			<input placeholder='Add new' type='text' id='todoInput' class="in-form">
		</div>
		<div id='outstandingTodos' class='todo-list'></div>
	</div>
</div>

<script type="text/javascript">

	var Todo = {

	isSubmitShown: false,
	numTodos: 0,

	init: function(todos)
	{
		Todo.createFormListeners();
	},

	createFormListeners: function()
	{
		// makes the form submit button look pretty
		Todo.makeNewTodoFieldClickable();
	},

	makeNewTodoFieldClickable: function()
	{
		$(".in-form").click(function(){

			Todo.listenForKeyboard();

		});
	},

	listenForKeyboard: function()
	{
		$("#todoInput").unbind("keyup").keyup(function(event){

			var who = "#todoInput";
			// grab the current val
			var val = $(who).val();

			// show/hide submit
			if (val.length === 1) Todo.showSubmit(who);
			else if (val.length === 0) Todo.hideSubmit();

		});
	},


	showSubmit: function(who)
	{
		if (!Todo.isSubmitShown)
		{
			var submitButton = "<div class='in-form-submit'>Submit</div>";

			$(submitButton).hide().appendTo($(who).parent()).fadeIn().addClass("nudge");

			$(".in-form-submit").click(function(){
				Todo.generateTodo();
				Todo.hideSubmit();
			});

			$("#todoInput").keypress(function(event){
				// add event listener so you can hit enter
				if (event.keyCode == 13) 
				{
					if (!$("#todoInput").val()) return false;
					else
					{
						Todo.generateTodo();
						Todo.hideSubmit();
					}
				}
			});
		}
		Todo.isSubmitShown = true;

	},

	hideSubmit: function()
	{
		if (Todo.isSubmitShown)
		{
			Todo.isSubmitShown = false;
			$(".in-form-submit").removeClass("nudge");
			Todo.resetFormState();
			Todo.listenForKeyboard();
		}
	},

	resetFormState: function()
	{
		// reset the forms and listeners to their initial state
		$("#todoInput").val("");
		$("#todoInput").unbind("keyup")
	},

	generateTodo: function()
	{

		var tString = $("#todoInput").val();
		var timeStamp = Todo.generateTimestamp();
			timeStamp = timeStamp.substr(0, timeStamp.length - 29);

		// UserManager.updateWidget(payload);
		Todo.addToFrontEnd(tString, timeStamp);

	},

	generateTimestamp: function()
	{
		return new Date().toString();
	},

	addToFrontEnd: function(content, timestamp)
	{
		var rand = Math.floor(Math.random() * 3) + 1;
		var rand2 = Math.floor(Math.random() * 3) + 1;

		var noteColour = "note-colour-" + rand;
		var noteRotate = "note-rotation-" + rand2;
		var pinPosition = "pin-location-" + rand2;

		// create a sticky note
		var content = "<div class='todo-list-item note-base "+noteColour+" "+noteRotate+"'><i class='pin "+pinPosition+"'></i><div class='todo-content'>"+ content +"</div><div class='todo-timestamp'>"+ timestamp +"</div></div>";
		
		// add it to the dom
		$(content).hide().appendTo($("#outstandingTodos")).fadeIn();

	}

};
</script>

